(function(){"use strict";var t={9227:function(t,e,a){var i=a(6848),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"risk-treatment-rules-page"},[e("el-scrollbar",{staticClass:"main-side shadow"},[e("Search",{attrs:{position:"horizontal","is-pack":!0,"is-operate":!1,"is-show":t.isShowMore},on:{search:t.doSearch,clear:t.doReset,show:t.showMoreFn}},[e("search-item",{attrs:{"col-width":262}},[e("template",{slot:"label"},[t._v(" 规则名称 ")]),e("template",{slot:"content"},[e("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:t.queryForm.ruleName,callback:function(e){t.$set(t.queryForm,"ruleName",e)},expression:"queryForm.ruleName"}})],1)],2),e("search-item",{attrs:{"col-width":262}},[e("template",{slot:"label"},[t._v(" 规则状态 ")]),e("template",{slot:"content"},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.queryForm.status,callback:function(e){t.$set(t.queryForm,"status",e)},expression:"queryForm.status"}},t._l(t.statusList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],2),e("search-item",{attrs:{"col-width":262}},[e("template",{slot:"label"},[t._v(" 车牌号 ")]),e("template",{slot:"content"},[e("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:t.queryForm.carNo,callback:function(e){t.$set(t.queryForm,"carNo",e)},expression:"queryForm.carNo"}})],1)],2),t.isShowMore?e("search-item",{attrs:{"col-width":262}},[e("template",{slot:"label"},[t._v(" 发生时间 ")]),e("template",{slot:"content"},[e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.queryForm.createTime,callback:function(e){t.$set(t.queryForm,"createTime",e)},expression:"queryForm.createTime"}})],1)],2):t._e(),t.isShowMore?e("search-item",{attrs:{"col-width":262}},[e("template",{slot:"label"},[t._v(" 创建人 ")]),e("template",{slot:"content"},[e("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:t.queryForm.creater,callback:function(e){t.$set(t.queryForm,"creater",e)},expression:"queryForm.creater"}})],1)],2):t._e(),t.isShowMore?e("search-item",{attrs:{"col-width":262}},[e("template",{slot:"label"},[t._v(" 更新人 ")]),e("template",{slot:"content"},[e("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:t.queryForm.updater,callback:function(e){t.$set(t.queryForm,"updater",e)},expression:"queryForm.updater"}})],1)],2):t._e()],1),e("div",{staticClass:"bg-white pt10 mt10"},[e("div",{staticClass:"mb10"},[e("div",{staticClass:"flex flex-j-end flex-vc"},[e("el-button",{staticClass:"mr10",attrs:{type:"primary",size:"medium"},on:{click:t.handleAdd}},[t._v(" 新增规则 ")])],1)]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"highlight-current-row":""}},[e("el-table-column",{attrs:{prop:"ruleName",label:"规则名称","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"ruleName",on:{click:function(e){return t.handleEdit(a.row,"detail")}}},[t._v(t._s(a.row.ruleName))])]}}])}),e("el-table-column",{attrs:{prop:"cars",label:"应用车辆数","min-width":"100"}}),e("el-table-column",{attrs:{prop:"events",label:"风险事件数","min-width":"100"}}),e("el-table-column",{attrs:{prop:"ruleStatus",label:"规则状态","min-width":"100"}}),e("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"100"}}),e("el-table-column",{attrs:{prop:"creater",label:"创建人","min-width":"100"}}),e("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"100"}}),e("el-table-column",{attrs:{prop:"updateTime",label:"更新时间","min-width":"100"}}),e("el-table-column",{attrs:{prop:"updater",label:"更新人","min-width":"100"}}),e("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"145"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticStyle:{padding:"0"},attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v(" 修改 ")]),e("el-button",{staticStyle:{color:"red"},attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleDelete(a.row)}}},[t._v(" 删除 ")])]}}])})],1)],1),e("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.pageInfo.page,limit:t.pageInfo.limit},on:{"update:page":function(e){return t.$set(t.pageInfo,"page",e)},"update:limit":function(e){return t.$set(t.pageInfo,"limit",e)},pagination:t.getList}})],1),e("AddEditDialog",{ref:"addEdit",on:{refresh:t.refreshList}})],1)},n=[],o=(a(4114),function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination-container",class:{hidden:t.hidden}},[e("el-pagination",t._b({attrs:{background:t.background,"current-page":t.currentPage,"page-size":t.pageSize,layout:t.layout,"page-sizes":t.pageSizes,total:t.total},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},"el-pagination",t.$attrs,!1))],1)}),s=[];Math.easeInOutQuad=function(t,e,a,i){return t/=i/2,t<1?a/2*t*t+e:(t--,-a/2*(t*(t-2)-1)+e)};var r=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();function c(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function d(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function u(t,e,a){const i=d(),l=t-i,n=20;let o=0;e="undefined"===typeof e?500:e;var s=function(){o+=n;var t=Math.easeInOutQuad(o,i,l,e);c(t),o<e?r(s):a&&"function"===typeof a&&a()};s()}var p={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get(){return this.page},set(t){this.$emit("update:page",t)}},pageSize:{get(){return this.limit},set(t){this.$emit("update:limit",t)}}},methods:{handleSizeChange(t){this.$emit("pagination",{page:this.currentPage,limit:t}),this.autoScroll&&u(0,800)},handleCurrentChange(t){this.$emit("pagination",{page:t,limit:this.pageSize}),this.autoScroll&&u(0,800)}}},h=p,m=a(1656),f=(0,m.A)(h,o,s,!1,null,"5c20bcb3",null),v=f.exports,y=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"add-edit-dialog",attrs:{title:t.title,visible:t.dialogVisible,"close-on-click-modal":!1,width:"1135px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",rules:t.rules}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("el-form-item",{attrs:{label:"规则名称",prop:"ruleName"}},[e("el-input",{staticStyle:{width:"240px"},attrs:{"show-word-limit":"",maxlength:"20",disabled:t.isdetail},model:{value:t.form.ruleName,callback:function(e){t.$set(t.form,"ruleName",e)},expression:"form.ruleName"}})],1)],1),e("el-col",{attrs:{span:10}},[e("el-form-item",{attrs:{label:"规则状态"}},[e("el-radio-group",{directives:[{name:"remove-ariaHidden",rawName:"v-remove-ariaHidden"}],attrs:{disabled:t.isdetail},model:{value:t.form.ruleStatus,callback:function(e){t.$set(t.form,"ruleStatus",e)},expression:"form.ruleStatus"}},[e("el-radio",{attrs:{label:"01"}},[t._v(" 启用 ")]),e("el-radio",{attrs:{label:"02"}},[t._v(" 禁用 ")])],1)],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:10}},[e("el-form-item",{attrs:{label:"风险事件",prop:"events"}},[e("el-select",{staticStyle:{width:"240px"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择",disabled:t.isdetail},on:{change:t.handleEventsChange},model:{value:t.form.events,callback:function(e){t.$set(t.form,"events",e)},expression:"form.events"}},t._l(t.riskEvents,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("el-col",{attrs:{span:10}},[e("el-form-item",{attrs:{label:"应用范围",prop:"vehicleIds"}},[e("div",{staticClass:"flex"},[e("el-select",{staticClass:"mr10",staticStyle:{width:"240px"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择车辆",disabled:t.isdetail},model:{value:t.form.vehicleIds,callback:function(e){t.$set(t.form,"vehicleIds",e)},expression:"form.vehicleIds"}},t._l(t.carList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})})),1),t.isdetail?t._e():e("span",{staticClass:"choice-text-btn",on:{click:t.choiceCar}},[t._v("选择车辆")])],1)])],1)],1)],1),e("div",{staticClass:"flex"},[e("div",{staticClass:"table-tit width128"},[t._v(" 告警项目 ")]),e("div",{staticClass:"table-tit width380"},[t._v(" 处理条件 ")]),e("div",{staticClass:"table-tit width130"},[t._v(" 告警等级 ")]),e("div",{staticClass:"table-tit width150"},[t._v(" 处理方式 ")]),e("div",{staticClass:"table-tit width300"},[t._v(" 通知内容 ")])]),t.form.events.length?t._e():e("div",{staticClass:"flex flex-hc p10 none-event"},[t._v(" 暂无数据，请先选择风险事件 ")]),e("div",{staticClass:"dialog-main",class:{active:!t.form.events.length}},t._l(t.allRiskEventsData,(function(a){return e("div",{key:a.value,staticClass:"flex demo-box"},[e("div",{staticClass:"demo-name items width128 flex flex-vc flex-j-start conditions-text"},[t._v(" "+t._s(a.label)+" ")]),e("div",t._l(a.riskEventsDetail,(function(i){return e("div",{key:i.timeKey,staticClass:"conditions width380"},[t._l(i.data,(function(a){return e("div",{key:a.conditionId,staticClass:"mb10"},[e("div",{staticClass:"flex flex-vc font12"},[e("el-checkbox",{staticClass:"mr10",attrs:{"true-label":1,"false-label":0,disabled:t.isdetail},on:{change:function(e){return t.handleCheck(a)}},model:{value:a.checked,callback:function(e){t.$set(a,"checked",e)},expression:"item.checked"}}),e("div",{staticClass:"flex flex-vc font12 row-wrap"},t._l(a.conditionDescArr,(function(i,l){return e("div",{key:l},[i.attrType?t._e():e("div",{staticClass:"mr5 conditions-text"},[t._v(" "+t._s(i.value)+" ")]),"01"==i.attrType?e("el-input-number",{staticClass:"mr5 small-input",staticStyle:{width:"60px"},attrs:{controls:!1,size:"mini",disabled:t.isdetail},model:{value:a.attrs[i.times-1].attrValue,callback:function(e){t.$set(a.attrs[i.times-1],"attrValue",e)},expression:"item.attrs[v.times-1].attrValue"}}):t._e(),"02"==i.attrType?e("div",{staticClass:"mr5"}):t._e(),e("div",{staticClass:"mr5"},["03"==i.attrType?e("el-select",{staticClass:"small-input",attrs:{disabled:t.isdetail},model:{value:a.attrs[i.times-1].attrValue,callback:function(e){t.$set(a.attrs[i.times-1],"attrValue",e)},expression:"item.attrs[v.times-1].attrValue"}},t._l(a.attrs[i.times-1].options,(function(t){return e("el-option",{key:t.optionId,attrs:{label:t.optionName,value:t.optionId}})})),1):t._e()],1)],1)})),0)],1),a.children?e("div",{staticClass:"ml25 mt10"},t._l(a.children,(function(a){return e("div",{key:a.conditionId},[e("div",{staticClass:"flex flex-vc mb10"},[e("el-checkbox",{staticClass:"mr10",attrs:{"true-label":1,"false-label":0},model:{value:a.checked,callback:function(e){t.$set(a,"checked",e)},expression:"i.checked"}}),t._l(a.conditionDescArr,(function(i,l){return e("div",{key:l},[i.attrType?t._e():e("div",{staticClass:"mr5 conditions-text"},[t._v(" "+t._s(i.value)+" ")]),"01"==i.attrType?e("el-input-number",{staticClass:"small-input mr5",staticStyle:{width:"60px"},attrs:{controls:!1,size:"mini",disabled:t.isdetail},model:{value:a.attrs[i.times-1].attrValue,callback:function(e){t.$set(a.attrs[i.times-1],"attrValue",e)},expression:"i.attrs[v.times-1].attrValue"}}):t._e(),"02"==i.attrType?e("div",{staticClass:"mr5"}):t._e(),e("div",{staticClass:"mr5"},["03"==i.attrType?e("el-select",{staticClass:"small-input",staticStyle:{width:"100px"},attrs:{disabled:t.isdetail},model:{value:a.attrs[i.times-1].attrValue,callback:function(e){t.$set(a.attrs[i.times-1],"attrValue",e)},expression:"i.attrs[v.times-1].attrValue"}},t._l(a.attrs[i.times-1].options,(function(t){return e("el-option",{key:t.optionValue,attrs:{label:t.optionName,value:t.optionValue}})})),1):t._e()],1)],1)}))],2)])})),0):t._e()])})),t.isdetail?t._e():e("div",{staticClass:"conditions-btns"},[e("el-button",{staticClass:"btn-common",attrs:{plain:"",disabled:a.riskEventsDetail.length<=1},on:{click:function(e){return t.handelConditionsDel(i,a)}}},[e("i",{staticClass:"el-icon-minus"})]),e("el-button",{staticClass:"btn-common",attrs:{type:"primary"},on:{click:function(e){return t.handelConditionsAdd(i,a)}}},[e("i",{staticClass:"el-icon-plus"})])],1)],2)})),0),e("div",{staticClass:"flex flex-d-column"},t._l(a.riskEventsDetail,(function(a){return e("div",{key:a.timeKey,staticClass:"level width130 flex1"},[e("div",[e("el-select",{staticClass:"meduim-input",staticStyle:{width:"100px"},attrs:{disabled:t.isdetail},model:{value:a.riskLevel,callback:function(e){t.$set(a,"riskLevel",e)},expression:"levelItem.riskLevel"}},t._l(t.levelOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)])})),0),e("div",{staticClass:"ways-box width150"},t._l(a.riskEventsDetail,(function(a){return e("div",{key:a.timeKey,staticClass:"ways width150"},t._l(a.alarmHandleConfigs,(function(i){return e("div",{key:i.timeKey,staticClass:"ways-item flex flex-vc flex-hc"},[e("el-select",{staticClass:"meduim-input",staticStyle:{width:"100px"},attrs:{disabled:t.isdetail},model:{value:i.handleType,callback:function(e){t.$set(i,"handleType",e)},expression:"waysItemChild.handleType"}},t._l(t.waysOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value,disabled:a.alarmHandleConfigs.map((t=>t.handleType)).includes(t.value)}})})),1),t.isdetail?t._e():e("div",{staticClass:"ways-btns"},[e("el-button",{staticClass:"btn-common",attrs:{plain:"",disabled:a.alarmHandleConfigs.length<=1},on:{click:function(e){return t.handleWaysDel(i,a.alarmHandleConfigs)}}},[e("i",{staticClass:"el-icon-minus"})]),e("el-button",{staticClass:"btn-common",attrs:{type:"primary",disabled:a.alarmHandleConfigs.length>=2},on:{click:function(e){return t.handleWaysAdd(i,a.alarmHandleConfigs)}}},[e("i",{staticClass:"el-icon-plus"})])],1)],1)})),0)})),0),e("div",{staticClass:"content-box width300"},t._l(a.riskEventsDetail,(function(i){return e("div",{key:i.timeKey,staticClass:"contents width300"},t._l(i.alarmHandleConfigs,(function(i){return e("div",{key:i.timeKey,staticClass:"contents-item flex flex-d-column flex-hc flex-vc"},["01"==i.handleType?e("div",[e("div",{staticClass:"flex flex-vc mb5"},[e("div",{staticClass:"fw600 w90 tar"},[t._v(" 通知内容： ")]),e("div",[e("el-select",{staticClass:"meduim-input",staticStyle:{width:"180px"},on:{change:function(e){return t.handleContentChange(i,a)}},model:{value:i.notifyContentType,callback:function(e){t.$set(i,"notifyContentType",e)},expression:"contentItemChild.notifyContentType"}},t._l(t.contentOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),"01"===i.notifyContentType?e("div",{staticClass:"flex flex-j-end"},[e("el-input",{staticClass:"meduim-input active",staticStyle:{width:"180px"},attrs:{type:"text",placeholder:"请输入自定义内容",disabled:"01"===i.notifyContentType},model:{value:i.notifyContent,callback:function(e){t.$set(i,"notifyContent",e)},expression:"contentItemChild.notifyContent"}})],1):t._e(),"02"===i.notifyContentType?e("div",{staticClass:"flex"},[e("div",{staticClass:"fw600 w90 tar"},[t._v(" 自定义内容： ")]),e("el-input",{staticClass:"custom meduim-input",staticStyle:{width:"180px"},attrs:{type:"textarea",rows:4,placeholder:"请输入自定义内容"},model:{value:i.notifyContent,callback:function(e){t.$set(i,"notifyContent",e)},expression:"contentItemChild.notifyContent"}})],1):t._e()]):t._e()])})),0)})),0)])})),0),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("div",{staticClass:"flex flex-j-end"},[t.isdetail?t._e():e("el-button",{staticStyle:{width:"72px"},attrs:{type:"primary",size:"medium"},on:{click:t.handleSave}},[t._v("保 存")])],1)]),e("ChoiceCarDialog",{attrs:{visible:t.innerVisible,"select-keys":t.form.vehicleIds,"config-id":t.form.configId,"car-list-data":t.carList},on:{"update:visible":function(e){t.innerVisible=e},onSaveCarList:t.handleSaveCarList}})],1)},b=[],g=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"choice-dialog",attrs:{title:"选择应用范围",visible:t.visible,"append-to-body":"","close-on-click-modal":!1,width:"742px"},on:{close:function(e){return t.$emit("update:visible",!1)}}},[e("div",{staticClass:"flex flex-j-between choice-main"},[e("div",{staticClass:"choice-left"},[e("div",[t._v("选择车辆")]),e("div",{staticClass:"content-area"},[e("div",{staticClass:"flex flex-hc mt10"},[e("el-input",{staticStyle:{width:"95%"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),e("div",{staticClass:"pl10 mt10 treeBox"},[e("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{"node-key":"id","show-checkbox":"",data:t.carList,props:t.defaultProps,"default-expand-all":"","filter-node-method":t.filterNode},on:{"check-change":t.getCurrentKey}})],1)])]),e("div",{staticClass:"choice-right"},[e("div",[t._v("已选车辆")]),e("div",{staticClass:"content-area right-area"},[e("div",{staticClass:"flex row-wrap"},t._l(t.checkKeysList,(function(a){return e("div",{key:a.id,staticClass:"choice-car-box"},[e("div",{staticClass:"choice-car flex flex-hc"},[e("div",{staticClass:"mr5"},[t._v(" "+t._s(a.label)+" ")]),e("div",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.handleDelCar(a.id)}}},[t._v(" x ")])])])})),0)])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("div",{staticClass:"flex flex-hc"},[e("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary",size:"medium"},on:{click:t.onSave}},[t._v("保 存")])],1)])])},C=[];const I=[{aggregation:"AND",attrs:[{attrId:1,attrKey:"CURRENT_SPEED",attrName:"当前车速",attrType:"01",conditionId:1,operator:"01"}],checked:0,conditionDesc:"告警时车速超过{}KM/h",conditionId:1,conditionName:"告警时超速",conditionType:"01",parentConditionId:0},{aggregation:"AND",attrs:[{attrId:2,attrKey:"ALARM_TIME",attrName:"告警时间",attrType:"02",conditionId:2,operator:"02"},{attrId:3,attrKey:"HISTORY_SPEED",attrName:"历史车速",attrType:"01",conditionId:2,operator:"01"}],checked:0,conditionDesc:"告警前{}分钟车速超过{}KM/h",conditionId:2,conditionName:"告警前超速",conditionType:"01",parentConditionId:0},{aggregation:"AND",attrs:[{attrId:4,attrKey:"ALARM_TIME",attrName:"告警时间",attrType:"01",conditionId:3,operator:"02"},{attrId:5,attrKey:"ALARM_COUNT",attrName:"告警次数",attrType:"01",conditionId:3,operator:"01"}],checked:0,conditionDesc:"告警频次超过{}分钟{}次",conditionId:3,conditionName:"告警频次超限",conditionType:"01",parentConditionId:0},{aggregation:"AND",attrs:[{attrId:6,attrKey:"DRIVE_TIME",attrName:"连续驾驶时间",attrType:"01",conditionId:4,operator:"01"}],checked:0,conditionDesc:"连续驾驶超过{}分钟",conditionId:4,conditionName:"连续驾驶超限",conditionType:"02",parentConditionId:0},{aggregation:"AND",attrs:[{attrId:7,attrKey:"HANDLE_TIME",attrName:"人工处理时间",attrType:"01",conditionId:5,operator:"01"}],checked:0,conditionDesc:"人工处理后{}分钟内再次告警",conditionId:5,conditionName:"人工处理超限",conditionType:"03",parentConditionId:0},{aggregation:"AND",attrs:[{attrId:8,attrKey:"ALARM_TIME",attrName:"告警时间",attrType:"01",conditionId:6,operator:"02"}],checked:0,children:[{aggregation:"OR",attrs:[{attrId:9,attrKey:"ALARM_TYPE",attrName:"风险事件",attrType:"03",conditionId:7,operator:"03",attrValue:"303",options:[{attrId:9,optionId:1,optionName:"抽烟",optionValue:"303"},{attrId:9,optionId:2,optionName:"接打电话",optionValue:"304"},{attrId:9,optionId:3,optionName:"分神驾驶",optionValue:"302"},{attrId:9,optionId:4,optionName:"疲劳驾驶",optionValue:"301"},{attrId:9,optionId:5,optionName:"前向碰撞",optionValue:"103"},{attrId:9,optionId:6,optionName:"车距过近",optionValue:"104"},{attrId:9,optionId:7,optionName:"车道偏离",optionValue:"105"},{attrId:9,optionId:8,optionName:"行人碰撞",optionValue:"106"}]},{attrId:10,attrKey:"RISK_LEVEL",attrName:"风险等级",attrType:"03",conditionId:7,operator:"03",attrValue:"1",options:[{attrId:10,optionId:9,optionName:"高风险",optionValue:"1"},{attrId:10,optionId:10,optionName:"中风险",optionValue:"2"},{attrId:10,optionId:11,optionName:"低风险",optionValue:"3"}]}],checked:0,conditionDesc:"{}{}",conditionId:7,conditionName:"抽烟",conditionType:"01",parentConditionId:6},{aggregation:"OR",attrs:[{attrId:11,attrKey:"ALARM_TYPE",attrName:"风险事件",attrType:"03",conditionId:8,operator:"03",attrValue:"304",options:[{attrId:11,optionId:12,optionName:"抽烟",optionValue:"303"},{attrId:11,optionId:13,optionName:"接打电话",optionValue:"304"},{attrId:11,optionId:14,optionName:"分神驾驶",optionValue:"302"},{attrId:11,optionId:15,optionName:"疲劳驾驶",optionValue:"301"},{attrId:11,optionId:16,optionName:"前向碰撞",optionValue:"103"},{attrId:11,optionId:17,optionName:"车距过近",optionValue:"104"},{attrId:11,optionId:18,optionName:"车道偏离",optionValue:"105"},{attrId:11,optionId:19,optionName:"行人碰撞",optionValue:"106"}]},{attrId:12,attrKey:"RISK_LEVEL",attrName:"风险等级",attrType:"03",conditionId:8,operator:"03",attrValue:"1",options:[{attrId:12,optionId:20,optionName:"高风险",optionValue:"1"},{attrId:12,optionId:21,optionName:"中风险",optionValue:"2"},{attrId:12,optionId:22,optionName:"低风险",optionValue:"3"}]}],checked:0,conditionDesc:"{}{}",conditionId:8,conditionName:"接打电话",conditionType:"01",parentConditionId:6}],conditionDesc:"告警前{}分钟 出现以下告警",conditionId:6,conditionName:"告警前出现告警",conditionType:"01",parentConditionId:0}],w=[{companyId:"01",companyName:"公司1",fleets:[{fleetId:"02",fleetName:"北京车队1",vehicles:[{vehicleId:"03",plateNo:"京A12345"},{vehicleId:"04",plateNo:"京A12346"},{vehicleId:"05",plateNo:"京A12347"}]},{fleetId:"06",fleetName:"北京车队2",vehicles:[{vehicleId:"07",plateNo:"京A12348"},{vehicleId:"08",plateNo:"京A12349"}]}]},{companyId:"09",companyName:"公司2",fleets:[{fleetId:"10",fleetName:"车队1",vehicles:[{vehicleId:"11",plateNo:"津A12345"},{vehicleId:"12",plateNo:"津A12346"},{vehicleId:"13",plateNo:"津A12347"}]}]},{companyId:"14",companyName:"公司3",fleets:[{fleetId:"15",fleetName:"车队1",vehicles:[{vehicleId:"16",plateNo:"沪A12345"},{vehicleId:"17",plateNo:"沪A12346"},{vehicleId:"18",plateNo:"沪A12346"},{vehicleId:"19",plateNo:"沪A12346"}]}]}];var x={props:{configId:{type:[Number,String],default:""},selectKeys:{type:Array,default:()=>[]},visible:{type:Boolean,default:!1},carListData:{type:Array,default:()=>[]}},watch:{filterText(t){this.$refs.tree.filter(t)},visible(t){t&&this.$nextTick((()=>{this.getCarList(),this.selectKeys.length>0&&this.carListData.length>0&&(this.checkKeysList=this.carListData.filter((t=>this.selectKeys.includes(t.id))))}))}},data(){return{checkKeysList:[],carList:[],filterText:"",defaultProps:{children:"children",label:"label"}}},methods:{handleDelCar(t){this.$refs.tree.setChecked(t,!1,!0)},getCurrentKey(){console.log(this.$refs.tree.getCheckedNodes());const t=this.$refs.tree.getCheckedNodes().map((t=>{if(t.plateNo)return{id:t.id,label:t.label}})).filter(Boolean);this.checkKeysList=t,console.log("checkKeys",t)},formatterCarList(t){return t.forEach((t=>{t.companyName&&(t.label=t.companyName,t.id=t.companyId,t.children=JSON.parse(JSON.stringify(t.fleets))),t.fleetName&&(t.label=t.fleetName,t.id=t.fleetId,t.children=JSON.parse(JSON.stringify(t.vehicles))),t.plateNo&&(t.id=t.vehicleId,t.label=t.plateNo),t.children&&this.formatterCarList(t.children)})),t},getCarList(){this.carList=this.formatterCarList(w),this.selectKeys&&this.$nextTick((()=>{this.$refs.tree.setCheckedKeys(this.selectKeys)}))},onSave(){this.$emit("onSaveCarList",this.checkKeysList),this.$emit("update:visible",!1)},filterNode(t,e){return!t||-1!==e.label.indexOf(t)}}},k=x,N=(0,m.A)(k,g,C,!1,null,"1e02c9b9",null),_=N.exports,S=a(7977),T={components:{ChoiceCarDialog:_},watch:{dialogVisible(t){t||(this.form=this.$options.data().form,this.$refs.form.resetFields(),this.returnViewSelect(this.form.events),this.alarmConditions=[],this.carList=[],this.isdetail=!1)}},data(){return{isdetail:!1,carList:[],levelOptions:[{value:3,label:"低风险"},{value:2,label:"中风险"},{value:1,label:"高风险"}],contentOptions:[{value:"01",label:"默认内容"},{value:"02",label:"自定义内容"}],waysOptions:[{value:"01",label:"语音通知"},{value:"02",label:"人工处理"}],allRiskEventsData:[],conditionModel:{},alarmConditions:[],riskEvents:[{value:"01",label:"分神驾驶"},{value:"02",label:"抽烟"},{value:"03",label:"疲劳驾驶"}],rules:{ruleName:[{required:!0,message:"请输入规则名称",trigger:"blur"}],vehicleIds:[{required:!0,message:"请选择车辆",trigger:"blur"}],events:[{required:!0,message:"请选择风险事件",trigger:"blur"}]},form:{vehicleIds:[],vehicleConfig:{vehicleIds:[]},events:[],ruleStatus:"01",ruleName:""},title:"告警通知规则配置",innerVisible:!1,dialogVisible:!1}},methods:{handleSaveCarList(t){console.log("carsData",t),this.carList=t,this.form.vehicleIds=t.map((t=>t.id))},handleEventsChange(t){console.log("eventChange",t),this.returnViewSelect(t)},handleWaysAdd(t,e){const a=t.timeKey,i=e.findIndex((t=>t.timeKey==a));e.splice(i+1,0,{handleType:"",notifyContent:"",notifyContentType:"",timeKey:Date.now()})},handleWaysDel(t,e){const a=t.timeKey,i=e.findIndex((t=>t.timeKey==a));e.splice(i,1)},handelConditionsAdd(t,e){const a=t.timeKey,i=e.riskEventsDetail.findIndex((t=>t.timeKey===a));e.riskEventsDetail.splice(i+1,0,{...(0,S.A)(this.conditionModel),timeKey:Date.now(),riskLevel:1,alarmHandleConfigs:[{handleType:"02",handleConfigId:"01",notifyContent:"",contentType:"",timeKey:Date.now()}]})},handelConditionsDel(t,e){const a=t.timeKey,i=e.riskEventsDetail.findIndex((t=>t.timeKey===a));e.riskEventsDetail.splice(i,1)},getModelData(){const t=I;this.handleModel(t),this.conditionModel={data:t},this.alarmConditions.push({...(0,S.A)(this.conditionModel),timeKey:Date.now(),riskLevel:1,alarmHandleConfigs:[{handleType:"02",handleConfigId:"01",notifyContent:"",contentType:"",timeKey:Date.now()}]}),console.log("this.alarmConditions",this.alarmConditions)},handleModel(t){t.forEach((t=>{let e=[];if(e){const a=t.conditionDesc.replaceAll("{}","*{}*").split("*").filter((t=>""!==t));e=this.validateRuleModel(a)}t.attrs&&t.attrs.length&&e.forEach((e=>{if("{}"==e.value){e.attrType=t.attrs[e.times-1].attrType,e.attrId=t.attrs[e.times-1].attrId;const a=t.attrs[e.times-1].hasOwnProperty("attrValue");!a&&this.$set(t.attrs[e.times-1],"attrValue","")}})),t.conditionDescArr=e,t.children&&this.handleModel(t.children)}))},validateRuleModel(t){const e=[],a={};return t.forEach(((t,i)=>{-1==e.findIndex((e=>e.value==t))?(e.push({value:t,index:i,times:1}),a[t]=1):(a[t]++,e.push({value:t,index:i,times:a[t]}))})),e},choiceCar(){this.innerVisible=!0},handleChild(t){const e=[];return t&&t.length?(t.forEach((t=>{t.children&&t.children.length>0?e.push(t,...t.children):e.push(t)})),e):[]},handleSave(){console.log("allRiskEventsData",this.allRiskEventsData),this.$refs["form"].validate((async t=>{if(!t)return;let e={configId:this.form.configId,ruleName:this.form.ruleName,ruleStatus:this.form.ruleStatus,vehicleConfig:{vehicleIds:this.form.vehicleIds},alarmConfigBases:this.allRiskEventsData.map((t=>({alarmType:t.value,alarmTypeName:t.label,alarmConfigList:t.riskEventsDetail.map((e=>({alarmConfigId:t.alarmConfigId,alarmType:t.value,riskLevel:e.riskLevel,alarmHandleConfigs:e.alarmHandleConfigs.map((t=>({handleType:t.handleType,notifyContent:t.notifyContent,notifyContentType:t.notifyContentType}))),alarmConditionConfigRelations:this.handleChild(e.data).map((t=>({aggregation:t.aggregation,attrValues:t.attrs.map((t=>({attrId:t.attrId,attrKey:t.attrKey,attrValue:t.attrValue}))),checked:t.checked,conditionId:t.conditionId})))})))})))};console.log("提交给后端的数据对象params",e),this.dialogVisible=!1,this.$emit("refresh",this.form)}))},returnViewSelect(t){let e=[];this.form.events=t,this.riskEvents.forEach((a=>{-1!=t.indexOf(a.value)&&e.push({value:a.code,label:a.label})})),this.allRiskEventsData=[],e.forEach((t=>{this.allRiskEventsData.push({...t,riskEventsDetail:[(0,S.A)(...this.alarmConditions)],riskLevel:"02"})})),console.log("this.allRiskEventsData",this.allRiskEventsData)},handleRelationsData(t,e){t.conditionId==e.conditionId&&(e.attrs.forEach((e=>{t.attrValues.forEach((t=>{e.attrId==t.attrId&&(e.attrValue=t.attrValue)}))})),e.checked=1)},handleRelations(t){if(console.log("relations",t),0==t.length)return;const e=(0,S.A)(this.conditionModel.data).map((e=>(t.forEach((t=>{this.handleRelationsData(t,e)})),e.children&&e.children.length>0&&e.children.map((e=>{t.forEach((t=>{this.handleRelationsData(t,e)}))})),e)));return console.log("newRelations",e),e},showDialog(t,e){this.getModelData(),t&&(this.isdetail="detail"===e,this.returnViewSelect(["01","02","03"])),this.dialogVisible=!0}}},D=T,E=(0,m.A)(D,y,b,!1,null,"e592777c",null),V=E.exports,A={components:{Pagination:v,AddEditDialog:V},created(){this.tableData.push({id:Date.now(),ruleName:"测试规则",cars:1,events:2,ruleStatus:"启用",creater:"admin",createTime:"2020-10-10",updater:"admin",updateTime:"2020-10-10"}),this.getList(),console.log("测试自动化部署~~~~~~~~~~~~~")},data(){return{tableData:[],statusList:[],pageInfo:{page:1,limit:20},total:0,isShowMore:!1,queryForm:{updater:"",creater:"",createTime:"",carNo:"",ruleStatus:"",ruleName:""}}},methods:{refreshList(t){this.tableData.push({id:Date.now(),ruleName:t.ruleName,ruleStatus:"启用",creater:"admin",createTime:"2020-10-10",updater:"admin",updateTime:"2020-10-10"}),this.total=this.tableData.length},handleAdd(){this.$refs.addEdit.showDialog()},handleDelete(t){console.log(t),this.$confirm("此操作将永久删除该规则, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.tableData=this.tableData.filter((e=>e.id!==t.id)),this.total=this.tableData.length,this.$message.success("删除成功")})).catch((()=>{}))},handleEdit(t,e){this.$refs.addEdit.showDialog(t,e)},doReset(){this.queryForm=this.$options.data().queryForm},showMoreFn(){this.isShowMore=!this.isShowMore},getList(){this.total=this.tableData.length},doSearch(){this.getList()}}},L=A,$=(0,m.A)(L,l,n,!1,null,"93b75e38",null),M=$.exports,K=a(9143),O=a.n(K),R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pl-search-component"},[e("div",{staticClass:"pl-search-content"},[t._t("default"),t.isSearch?e("search-item",{staticClass:"text-right pull-right",attrs:{"col-width":t.isPack?198:160}},[e("template",{slot:"content"},[e("el-button",{staticClass:"ml0",attrs:{type:"primary",size:"medium"},on:{click:t.search}},[t._v(" 查询 ")]),t.isClear?e("el-button",{attrs:{type:"default",plain:"",size:"medium"},on:{click:t.clear}},[t._v(" 重置 ")]):t._e(),t.isPack?e("span",{staticClass:"ml10 text-btn-primary pointer",on:{click:t.packClick}},[e("span",{directives:[{name:"show",rawName:"v-show",value:!t.isShow,expression:"!isShow"}]},[t._v("展开"),e("i",{staticClass:"icon el-icon-caret-bottom"})]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}]},[t._v("收起"),e("i",{staticClass:"icon el-icon-caret-top"})])]):t._e(),t._t("download")],2)],2):t._e()],2),t.isOperate?e("div",{staticClass:"pl-search-operate"},[t._t("footer")],2):t._e()])},q=[],z={name:"Search",componentName:"Search",provide(){return{Search:this}},props:{isSearch:{default:!0},isPack:{default:!1},isOperate:{default:!0},isShow:{default:!1},position:{default:""},labelWidth:{default:"auto"},labelPosition:{default:"left"},isClear:{default:!0}},created(){this.calcMatchMedia(),window.addEventListener("resize",this.calcMatchMedia)},beforeDestroy(){window.removeEventListener("resize",this.calcMatchMedia)},methods:{packClick(){this.$emit("show")},search(){this.$emit("search")},clear(){this.$emit("clear")},calcMatchMedia(){let t=null;const e=window.matchMedia("(max-width:1360px) and (min-width:960px)"),a=window.matchMedia("(max-width:1760px) and (min-width:1360px)"),i=window.matchMedia("(min-width:1760px)");e.matches?t="33.3%":a.matches?t="25%":i.matches&&(t="20%")}}},F=z,P=(0,m.A)(F,R,q,!1,null,"72ba88c5",null),H=P.exports,W=function(){var t=this,e=t._self._c;return e("div",{staticClass:"platform-col",class:[t.colPosition,t.inner?"":"mb15"],style:t.colStyle},[t._t("default",(function(){return[e("label",{staticClass:"platform-col-label",style:t.labelStyle},[t._t("label")],2),e("div",{staticClass:"platform-col-content"},[t._t("content")],2)]}))],2)},j=[];const B="33.3%";var J={name:"SearchItem",componentName:"SearchItem",inject:["Search"],props:{labelWidth:{default:"auto"},colWidth:{type:[Number,String],default:B},inner:{type:Boolean,default:!1},space:{type:Number,default:10}},computed:{labelStyle(){return"horizontal"==this.Search.position?{width:this.labelWidth||this.Search.labelWidth,"text-align":this.Search.labelPosition}:null},colPosition(){return this.Search.position},colStyle(){let t,e;null!==this.mediaWidth&&(e=this.mediaWidth),"number"===typeof this.colWidth?t=this.colWidth+"px":this.colWidth&&-1!==(this.colWidth&&this.colWidth.indexOf("%"))?t=this.colWidth===B?e:this.colWidth:(t=e||B,console.warn(`SearchItem组件的col-width参数需要为string类型时，需传“%”,否则取默认值“${B}”，不可预期`));let a=this.space;return""===a&&(a=0),{width:t,"padding-left":`${a}px`,"padding-right":`${a}px`}}}},Y=J,Q=(0,m.A)(Y,W,j,!1,null,"4d42888d",null),U=Q.exports;i["default"].component(H.name,H),i["default"].component(U.name,U);var G={bind(t,e){let a=t.querySelectorAll(".el-radio__original");a.forEach((t=>{t.removeAttribute("aria-hidden")}))}};i["default"].directive("remove-ariaHidden",G),i["default"].config.productionTip=!1,i["default"].use(O()),new i["default"]({render:t=>t(M)}).$mount("#app")}},e={};function a(i){var l=e[i];if(void 0!==l)return l.exports;var n=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=t,function(){a.amdO={}}(),function(){var t=[];a.O=function(e,i,l,n){if(!i){var o=1/0;for(d=0;d<t.length;d++){i=t[d][0],l=t[d][1],n=t[d][2];for(var s=!0,r=0;r<i.length;r++)(!1&n||o>=n)&&Object.keys(a.O).every((function(t){return a.O[t](i[r])}))?i.splice(r--,1):(s=!1,n<o&&(o=n));if(s){t.splice(d--,1);var c=l();void 0!==c&&(e=c)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[i,l,n]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,i){var l,n,o=i[0],s=i[1],r=i[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(l in s)a.o(s,l)&&(a.m[l]=s[l]);if(r)var d=r(a)}for(e&&e(i);c<o.length;c++)n=o[c],a.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return a.O(d)},i=self["webpackChunkvue2_element"]=self["webpackChunkvue2_element"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=a.O(void 0,[504],(function(){return a(9227)}));i=a.O(i)})();
//# sourceMappingURL=app.d0562d6f.js.map